



GROW                                                          C. Cardona
Internet-Draft                                                P. Lucente
Intended status: Standards Track                                     NTT
Expires: September 3, 2023                                       T. Graf
                                                                Swisscom
                                                               B. Claise
                                                                  Huawei
                                                           March 2, 2023


                            BMP YANG Module
                      draft-ietf-grow-bmp-yang-01

Abstract

   This document proposes a YANG module for BMP (BGP Monitoring
   Protocol) configuration and monitoring.  A complementary RPC triggers
   a refresh of the session of a BMP monitoring station.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on September 3, 2023.

Copyright Notice

   Copyright (c) 2023 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of



Cardona , et al.        Expires September 3, 2023               [Page 1]

Internet-Draft               BMP YANG Module                  March 2023


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   3.  Model summary . . . . . . . . . . . . . . . . . . . . . . . .   2
   4.  Base ietf-bmp YANG module . . . . . . . . . . . . . . . . . .   3
     4.1.  Tree View . . . . . . . . . . . . . . . . . . . . . . . .   3
     4.2.  YANG Module . . . . . . . . . . . . . . . . . . . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .  23
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  23
     6.1.  The IETF XML Registry . . . . . . . . . . . . . . . . . .  23
     6.2.  The YANG Module Name Registration . . . . . . . . . . . .  24
   7.  Open Issues . . . . . . . . . . . . . . . . . . . . . . . . .  24
   8.  Normative References  . . . . . . . . . . . . . . . . . . . .  24
   Appendix A.  Examples . . . . . . . . . . . . . . . . . . . . . .  26
     A.1.  Example one . . . . . . . . . . . . . . . . . . . . . . .  26
     A.2.  Example two . . . . . . . . . . . . . . . . . . . . . . .  27
   Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . .  30
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  30

1.  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

   Routing Information Bases, peers, monitoring stations, and initiation
   messages are defined in [RFC7854].

2.  Introduction

   This document specifies a YANG module for configuring and monitoring
   the BGP Monitoring Protocol (BMP) [RFC7854].  The model provides
   parameters for defining sessions to BMP monitoring stations; the
   selection of the BGP Routing Information Bases (RIBs) for Route
   Monitoring Messages; provides operational metrics and enables
   reseting of BMP monitoring sessions.

3.  Model summary

   The BMP YANG model provides the methods for managing BMP monitoring
   stations.  It includes:




Cardona , et al.        Expires September 3, 2023               [Page 2]

Internet-Draft               BMP YANG Module                  March 2023


   o  Connectivity parameters, including monitoring station IP
      address(es) and destination port(s).

   o  BMP session parameters, such as defining the BMP initiation
      message or the interval for statistics messages.

   o  BGP data sources for Route Monitoring Messages.  The model
      requires the explicit configuration of the network instance, RIBs,
      and address family to send to each monitoring station over Route
      Monitoring Messages.  For Adj-RIB-in and Adj-RIB-out, both pre and
      post policy, the model also requires to reference the peer.  In
      those RIBs, the identity "bmp-peer-types-all-peers" can be used if
      the operators desire to receive data of all peers.

   o  Per BMP station status and statistics, such as established status,
      number of route-monitoring messages, number of route-mirroring
      messages, number of peer-down and peer-up messages, number of
      initiation messages.

   o  BMP session reset RPC action.

4.  Base ietf-bmp YANG module

4.1.  Tree View

   The following tree diagram provides an overview of the ietf-bmp.yang
   data model.

   =============== NOTE: '\\' line wrapping per RFC 8792 ===============

   module: ietf-bmp
     +--rw bmp
        +--rw monitoring-stations
           +--rw monitoring-station* [id]
              +--rw id               string
              +--rw connection
              |  +--rw (passive-or-active)?
              |  |  +--:(active)
              |  |  |  +--rw active
              |  |  |     +--rw network-instance?   leafref
              |  |  |     +--rw station-address     inet:ip-address
              |  |  |     +--rw station-port        inet:port-number
              |  |  |     +--rw local-address       inet:ip-address
              |  |  |     +--rw local-port?         inet:port-number
              |  |  +--:(passive)
              |  |     +--rw passive
              |  |        +--rw network-instance?   leafref
              |  |        +--rw station-address     inet:ip-address



Cardona , et al.        Expires September 3, 2023               [Page 3]

Internet-Draft               BMP YANG Module                  March 2023


              |  |        +--rw station-port?       inet:port-number
              |  |        +--rw local-address       inet:ip-address
              |  |        +--rw local-port          inet:port-number
              |  +--rw tcp-options
              |  |  +--rw maximum-segment-size?    uint16
              |  |  +--rw mtu-discovery?           boolean
              |  |  +--rw keepalives! {keepalives-supported}?
              |  |  |  +--rw idle-time         uint16
              |  |  |  +--rw max-probes        uint16
              |  |  |  +--rw probe-interval    uint16
              |  |  +--rw secure-session-enable?   boolean
              |  |  +--rw secure-session
              |  |     +--rw (authentication)?
              |  |        +--:(ao)
              |  |        |  +--rw ao-keychain?
              |  |        |          key-chain:key-chain-ref
              |  |        +--:(md5)
              |  |           +--rw md5-keychain?
              |  |                   key-chain:key-chain-ref
              |  +--rw initial-delay?   uint32
              |  +--rw backoff
              |     +--rw (backoff-options)?
              |        +--:(simple-exponential)
              |           +--rw simple-exponential
              |              +--rw initial-backoff?   uint32
              |              +--rw maximum-backoff?   uint32
              +--rw bmp-data
              |  +--rw initiation-message?      string
              |  +--rw bmp-statistics-report!
              |  |  +--rw statistics-interval    uint32
              |  +--rw bmp-route-monitoring
              |     +--rw network-instances
              |        +--rw network-instance* [network-instance-id]
              |           +--rw network-instance-id    union
              |           +--rw enabled?               boolean
              |           +--rw adj-rib-in-pre
              |           |  +--rw address-families
              |           |     +--rw address-family*
              |           |             [address-family-id]
              |           |        +--rw address-family-id
              |           |        |       identityref
              |           |        +--rw enabled?
              |           |        |       boolean
              |           |        +--rw peers
              |           |           +--rw peer* [peer-id]
              |           |              +--rw peer-id    union
              |           |              +--rw enabled?   boolean
              |           |              +--rw filters



Cardona , et al.        Expires September 3, 2023               [Page 4]

Internet-Draft               BMP YANG Module                  March 2023


              |           |                 +--rw policy-filter
              |           |                    +--rw export-policy*    \
   \       leafref
              |           |                    +--rw default-export-pol\
   \icy?
              |           |                            rt-pol:default-p\
   \olicy-type
              |           +--rw adj-rib-in-post
              |           |  +--rw address-families
              |           |     +--rw address-family*
              |           |             [address-family-id]
              |           |        +--rw address-family-id
              |           |        |       identityref
              |           |        +--rw enabled?
              |           |        |       boolean
              |           |        +--rw peers
              |           |           +--rw peer* [peer-id]
              |           |              +--rw peer-id    union
              |           |              +--rw enabled?   boolean
              |           |              +--rw filters
              |           |                 +--rw policy-filter
              |           |                    +--rw export-policy*    \
   \       leafref
              |           |                    +--rw default-export-pol\
   \icy?
              |           |                            rt-pol:default-p\
   \olicy-type
              |           +--rw local-rib
              |           |  +--rw address-families
              |           |     +--rw address-family*
              |           |             [address-family-id]
              |           |        +--rw address-family-id
              |           |        |       identityref
              |           |        +--rw filters
              |           |           +--rw policy-filter
              |           |              +--rw export-policy*          \
   \ leafref
              |           |              +--rw default-export-policy?
              |           |                      rt-pol:default-policy-\
   \type
              |           +--rw adj-rib-out-pre
              |           |  +--rw address-families
              |           |     +--rw address-family*
              |           |             [address-family-id]
              |           |        +--rw address-family-id
              |           |        |       identityref
              |           |        +--rw enabled?
              |           |        |       boolean



Cardona , et al.        Expires September 3, 2023               [Page 5]

Internet-Draft               BMP YANG Module                  March 2023


              |           |        +--rw peers
              |           |           +--rw peer* [peer-id]
              |           |              +--rw peer-id    union
              |           |              +--rw enabled?   boolean
              |           |              +--rw filters
              |           |                 +--rw policy-filter
              |           |                    +--rw export-policy*    \
   \       leafref
              |           |                    +--rw default-export-pol\
   \icy?
              |           |                            rt-pol:default-p\
   \olicy-type
              |           +--rw adj-rib-out-post
              |              +--rw address-families
              |                 +--rw address-family*
              |                         [address-family-id]
              |                    +--rw address-family-id
              |                    |       identityref
              |                    +--rw enabled?
              |                    |       boolean
              |                    +--rw peers
              |                       +--rw peer* [peer-id]
              |                          +--rw peer-id    union
              |                          +--rw enabled?   boolean
              |                          +--rw filters
              |                             +--rw policy-filter
              |                                +--rw export-policy*    \
   \       leafref
              |                                +--rw default-export-pol\
   \icy?
              |                                        rt-pol:default-p\
   \olicy-type
              +--rw session-stats
              |  +--rw discontinuity-time
              |  |       yang:date-and-time
              |  +--ro established-session?               boolean
              |  +--ro total-route-monitoring-messages?   uint64
              |  +--ro total-statistics-messages?         uint64
              |  +--ro total-peer-down-messages?          uint64
              |  +--ro total-peer-up-messages?            uint64
              |  +--ro total-initiation-messages?         uint64
              |  +--ro total-route-mirroring-messages?    uint64
              +--rw actions
                 +---x session-reset
                    +--ro output
                       +--ro (outcome)?
                          +--:(success)
                          |  +--ro success?   empty



Cardona , et al.        Expires September 3, 2023               [Page 6]

Internet-Draft               BMP YANG Module                  March 2023


                          +--:(failure)
                             +--ro failure?   string

4.2.  YANG Module

   <CODE BEGINS> file "ietf-bmp@2022-01-27.yang"

   module ietf-bmp {
     yang-version 1.1;
     namespace "urn:ietf:params:xml:ns:yang:ietf-bmp";
     prefix bmp;

     import ietf-yang-types {
        prefix yang;
      }

     import ietf-inet-types {
       prefix inet;
       reference
         "RFC 6991: Common YANG Data Types";
     }

     import ietf-bgp-types {
       prefix bt;
       reference
         "RFC AAAA: BGP YANG module for Service Provider Network.
          RFC-EDITOR: please update XXX with the RFC ID assigned
          to I-D.ietf-idr-bgp-model";
     }

     import ietf-netconf-acm {
       prefix nacm;
       reference
         "RFC 8341: Network Configuration Access Control Model";
     }

     import ietf-tcp-common {
       prefix "tcpcmn";
       reference
         "I-D.ietf-netconf-tcp-client-server: YANG Groupings for TCP
          Clients and TCP Servers.";
     }

     import ietf-network-instance {
       prefix "ni";
       reference
       "RFC 8529: YANG Data Model for Network Instances";
     }



Cardona , et al.        Expires September 3, 2023               [Page 7]

Internet-Draft               BMP YANG Module                  March 2023


     import ietf-routing-policy {
       prefix "rt-pol";
       reference
       "RFC 9067: A YANG Data Model for Routing Policy";

     }

     import ietf-key-chain {
          prefix key-chain;
          reference
            "RFC 8177: YANG Key Chain.";
     }

     organization
       "IETF GROW Working Group";
     contact
       "WG Web:   <https://datatracker.ietf.org/wg/grow/>
        WG List:  <mailto:grow@ietf.org>

        Author:  Camilo Cardona
           <mailto:camilo@ntt.net>

        Author:  Paolo Lucente
           <mailto:cpaolo@ntt.net>

        Author:  Thomas Graf
           <mailto:thomas.graf@swisscom.com>

        Author:  Benoit Claise
           <mailto:benoit.claise@huawei.com>";
     description
       "This module specifies a structure for BMP
        (BGP Monitoring Protocol) configuration and monitoring.

        The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL',
        'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED',
        'NOT RECOMMENDED', 'MAY', and 'OPTIONAL' in this document
        are to be interpreted as described in BCP 14 (RFC 2119)
        (RFC 8174) when, and only when, they appear in all
        capitals, as shown here.

        Copyright (c) 2022 IETF Trust and the persons identified as
        authors of the code.  All rights reserved.

        Redistribution and use in source and binary forms, with or
        without modification, is permitted pursuant to, and subject to
        the license terms contained in, the Revised BSD License set
        forth in Section 4.c of the IETF Trust's Legal Provisions



Cardona , et al.        Expires September 3, 2023               [Page 8]

Internet-Draft               BMP YANG Module                  March 2023


        Relating to IETF Documents
        (https://trustee.ietf.org/license-info).

        This version of this YANG module is part of RFC 9196
        (https://www.rfc-editor.org/info/rfc9196); see the RFC itself
        for full legal notices.";

     revision 2022-10-18 {
       description
         "initial version";
       reference
         "RFC YYYY: BMP YANG Module
         RFC-EDITOR: please update YYYY with this RFC ID";
     }

     identity bmp-peer-types {
       description
       "Enum values for multiple selecting peer's
       Routing Information Bases (RIB) for configuration.";
     }

     identity bmp-peer-types-all-peers {
       base bmp-peer-types;
       description
       "This identity selects all peer's RIBs.
       When used, it act as a 'default' configuration.";
     }

     identity bmp-ni-types {
       description "Enum values for selecting multiple Network instances
       for configuration";
     }

     identity bmp-ni-types-all-ni {
       base bmp-ni-types;
       description "The identify is an explicit way
         of selecting all network instances.";
     }

     identity bmp-ni-types-global-ni {
       base bmp-ni-types;
       description "Selects the global network instance";
     }

     grouping bmp-tcp-options {
       description
         "TCP options for the connection to the station";
       leaf maximum-segment-size {



Cardona , et al.        Expires September 3, 2023               [Page 9]

Internet-Draft               BMP YANG Module                  March 2023


         type uint16;
         description
           "Maximum segment size for the TCP connections.";
       }

       // Taken from the bgp yang module
       leaf mtu-discovery {
           type boolean;
           description
             "Turns path mtu discovery for the  TCP sessions
             on (true) or off (false).";
           reference
             "RFC 1191: Path MTU discovery.";
         }
       uses tcpcmn:tcp-common-grouping;

       // taken from the bgp yang module
       leaf secure-session-enable {
          type boolean;
          default "false";
          description
            "Does this session need to be secured?";
       }

      container secure-session {
        when "../secure-session-enable = 'true'";
        description
          "Container for describing how a particular BMP session
           is to be secured.";

         choice authentication {
          case ao {
            leaf ao-keychain {
              type key-chain:key-chain-ref;
              description
                "Reference to the key chain that will be used by
                 this model. Applicable for TCP-AO and TCP-MD5
                 only";
              reference
                "RFC 8177: YANG Key Chain.";
            }
            description
              "Uses TCP-AO to secure the session. Parameters for
               those are defined as a grouping in the TCP YANG
               model.";
            reference
              "RFC 5925 - The TCP Authentication Option.";
         }



Cardona , et al.        Expires September 3, 2023              [Page 10]

Internet-Draft               BMP YANG Module                  March 2023


          case md5 {
            leaf md5-keychain {
              type key-chain:key-chain-ref;
              description
                "Reference to the key chain that will be used by
                 this model. Applicable for TCP-AO and TCP-MD5
                 only";
              reference
                "RFC 8177: YANG Key Chain.";
            }
            description
              "Uses TCP-MD5 to secure the session. Parameters for
               those are defined as a grouping in the TCP YANG
               model.";
            reference
              "RFC 5925: The TCP Authentication Option.";
          }
          description
            "Choice of TCP authentication.";
         }
      }


     }

     grouping bmp-ip-connection {
       description
         "common elements for defining connectivity
          to a BMP monitoring station";
       choice passive-or-active {
         description
           "Choice for active or passive connection as described
           in section 3.2 of RFC 7854";
         case active {
           description
             "The device starts the connection to the monitoring
             station";
           container active {
             description
               "The device starts the connection to
               the monitoring station";
             leaf network-instance {
               type leafref {
                 path "/ni:network-instances/ni:network-instance/"
                    + "ni:name";
               }
               description
                 "If present, specifies the network instance



Cardona , et al.        Expires September 3, 2023              [Page 11]

Internet-Draft               BMP YANG Module                  March 2023


                 used to reach the monitoring station.";
             }
             leaf station-address {
               type inet:ip-address;
               mandatory true;
               description
                 "Destination IP address of monitoring station";
             }
             leaf station-port {
               type inet:port-number;
               mandatory true;
               description
                 "Destination port of the station";
             }
             leaf local-address {
               type inet:ip-address;
               mandatory true;
               description
                 "Local IP address to source active connection";
             }
             leaf local-port {
               type inet:port-number;
               description
                 "Optional Local port for active connection";
             }

           }

         }

         case passive {
           description
             "The device waits for the connection
             in a local endpoint";
           container passive {
             description
               "The device waits for the connection
               in a local endpoint";
             leaf network-instance {
               type leafref {
                 path "/ni:network-instances/ni:network-instance/"
                    + "ni:name";
               }
               description
                 "If present, specifies the network instance
                 used to reach the monitoring station.";
             }
             leaf station-address {



Cardona , et al.        Expires September 3, 2023              [Page 12]

Internet-Draft               BMP YANG Module                  March 2023


               type inet:ip-address;
               mandatory true;
               description
                 "address of the station";
             }
             leaf station-port {
               type inet:port-number;
               description
                 "Optional value identifying the origin port of
                 the connection, if provided it MUST match";
             }
             leaf local-address {
               type inet:ip-address;
               mandatory true;
               description
                 "Local IP address to wait for the connection";
             }
             leaf local-port {
               type inet:port-number;
               mandatory true;
               description
                 "Local port to wait for the connection";
             }

           }

         }
       }
     }

     grouping bmp-source-configuration {
       description
       "Group containing some general characteristics for configuring
       a BMP source";

       container filters {
         description
         "Includes containers specifying filters for deciding
         which routes to export to the station";
         container policy-filter {
             description
             "Filter routes based on a policy.
             The policy SHOULD not perform any action besides
             filtering routes.
             The policy SHOULD only contain accept and reject
             routes, and the matching conditions SHOULD only
             match prefix sets.";
             leaf-list export-policy {



Cardona , et al.        Expires September 3, 2023              [Page 13]

Internet-Draft               BMP YANG Module                  March 2023


              type leafref {
                path "/rt-pol:routing-policy/"
                   + "rt-pol:policy-definitions/"
                   + "rt-pol:policy-definition/rt-pol:name";
                require-instance true;
              }
              ordered-by user;
              description
                 "List of policy names in sequence used to select
                 routes to be exported to station.";
            }
            leaf default-export-policy {
              type rt-pol:default-policy-type;
              default "accept-route";
              description
                "Explicitly set a default policy if no policy
                definition in the export policy chain
                is satisfied.";
            }
         }
       }
     }

     grouping bmp-peer-ribs-filter {
       description
         "Leaves for configuring RIBs where
          origin/destination peers are defined.";

       container address-families {
         description
           "container for lists of address-families";
         list address-family {
           key "address-family-id";
           description
             "List of address families.
              The name of the address family, as defined
              in the BGP model is used for keying.";

           // If we knew the network instance,
           // we could list the AF directly from the configured
           // ones, as we for instance show next for the global one.
           // leaf name {
           //   type leafref {
           //     path "/rt:routing/rt:control-plane-protocols/"
           //        + "rt:control-plane-protocol/bgp:bgp/"
           //        + "bgp:global/bgp:afi-safis/bgp:afi-safi/bgp:name";
           //   }
           //   description



Cardona , et al.        Expires September 3, 2023              [Page 14]

Internet-Draft               BMP YANG Module                  March 2023


           //     "Name of the address family";
           // }
           // However, since is not aware if we are doing global,
           // and individual NT or a default, we cannot
           // contraint it to this.
           leaf address-family-id {
             type identityref {
               base bt:afi-safi-type;
             }
             description
             "Address family id to configure";
           }

           leaf enabled {
             type boolean;
             default true;
             description
               "Enables route monitoring messages
               for the address family";
           }

           container peers {
             description
             "Identification of peers
             for which we send BMP data to the collector";
             list peer {
               key "peer-id";
               description
               "Identification of peers
               for which we send BMP data to the collector";
               leaf peer-id {
                 type union {
                   // inet:ip-address reflects a neighbor
                   // but since the model is not aware of
                   // the ni, it doesn not know from where to get it
                   // e.g. if we knew were were referencing
                   //      the global instance, we could do:
                   // type leafref {
                   //   path "/rt:routing/rt:control-plane-protocols/"
                   //   + "rt:control-plane-protocol/bgp:bgp/"
                   //   + "bgp:neighbors/bgp:neighbor/"
                   //   + "bgp:remote-address";
                   // }
                   type inet:ip-address;
                   type bt:peer-type;
                   type identityref {
                     base bmp-peer-types;
                   }



Cardona , et al.        Expires September 3, 2023              [Page 15]

Internet-Draft               BMP YANG Module                  March 2023


                 }
                 description
                   "Peers can be identified by a remote-address,
                    by the bgp type of the peers,
                    or by an enum value corresponding to groups
                    of peers.  This way an operator can
                    select, for example, all external peers,
                    all internal peers, or all peers.";
               }

               leaf enabled {
                 type boolean;
                 default true;
                 description
                   "Enables routing monitoring messages
                   for the peer(s).";
               }
               uses bmp-source-configuration;

             }
           }
         }
       }
     }

     grouping bmp-route-monitoring-sources {
       description
         "Route monitoring sources";
       reference "RFC7854:  BGP Monitoring Protocol, Section 5.";

       container network-instances {
         description
         "container for lists of network-instances";
         list network-instance {
           key "network-instance-id";
           description
             "Network instance to monitory using BMP.";

           leaf network-instance-id {
             type union {
               type leafref {
                 path "/ni:network-instances/ni:network-instance/"
                    + "ni:name";
               }
               type identityref {
                 base bmp-ni-types;
               }
             }



Cardona , et al.        Expires September 3, 2023              [Page 16]

Internet-Draft               BMP YANG Module                  March 2023


             description
               "Identification of a network-instance.
               Network instances can be identified
               directly by their path or use an identity to
               identify one or a group of them
               (e.g. bmp-ni-types-all-ni for all of them)";

           }


           leaf enabled {
             type boolean;
             default true;
             description
               "Enables routing monitoring
               messages for the network instance.";
           }

           container adj-rib-in-pre {
             description
               "Configuration for the adj-rib-in pre-policy";
             reference
               "RFC7854: BGP Monitoring Protocol (BMP), Section 2.";
             uses bmp-peer-ribs-filter;
           }
           container adj-rib-in-post {
             description
               "Configuration for the adj-rib-in post-policy";
             reference
               "RFC7854: BGP Monitoring Protocol (BMP), Section 2.";
             uses bmp-peer-ribs-filter;
           }
           container local-rib {
             description
               "Configuration for the local-rib";
             reference
               "RFC9069: Support for Local RIB in the BGP Monitoring
               Protocol (BMP), Section 3.";

             container address-families {
               description
                 "List of address families to enable for
                  local-rib.";
               list address-family {
                 key "address-family-id";
                 description
                  "Address family to enable for local-rib";
                 leaf address-family-id {



Cardona , et al.        Expires September 3, 2023              [Page 17]

Internet-Draft               BMP YANG Module                  March 2023


                   type identityref {
                     base bt:afi-safi-type;
                   }
                   description
                   "Address family id to enable for local-rib";
                 }
                 uses bmp-source-configuration;
               }
             }
           }
           container adj-rib-out-pre {
             description
               "Configuration for the adj-rib-out pre-policy";
             uses bmp-peer-ribs-filter;
             reference
               "RFC8671: Support for Adj-RIB-Out in the BGP Monitoring
               Protocol (BMP) , Section 3.";
           }
           container adj-rib-out-post {
             description
               "Configuration for the adj-rib-out post-policy";
             uses bmp-peer-ribs-filter;
             reference
               "RFC8671: Support for Adj-RIB-Out in the BGP Monitoring
               Protocol (BMP) , Section 3.";
           }

         }

       }

     }


     container bmp {
       description
         "Main level for BMP configuration ";
       container monitoring-stations {
         description
           "Container for the list of BMP monitoring stations";
         list monitoring-station {
           key "id";
           description
             "Configuration for a BMP monitoring station.";
           leaf id {
             type string;
             description
               "Identification string for the monitoring station";



Cardona , et al.        Expires September 3, 2023              [Page 18]

Internet-Draft               BMP YANG Module                  March 2023


           }
           // Connection, missing tcp tuning params
           // like keep-alives, segment sizes, etc.
           container connection {
             description
               "Connection details for the monitoring station";
             uses bmp-ip-connection;

             container tcp-options {
               description
                "TCP options for the connection to the monitoring
                station";
               uses bmp-tcp-options;
             }

             leaf initial-delay {
               type uint32;
               units "seconds";
               default 0;
               description
                 "Initial delay of the connection to the station";
             }

             container backoff {
               description
                 "Configures the backoff strategy after a connection
                 retry";
               reference "RFC7854 Section 3.2";
               choice backoff-options {
                 description
                   "Options for backoff strategies";
                 reference "RFC7854 Section 3.2";
                 case simple-exponential {
                   description
                     "Simple exponential backoff with limits.";
                   container simple-exponential {
                     description
                       "Simple exponential backoff with limits.
                       Starts with the initial backoff and doubles
                       the backoff of every retry until reaching the
                       maximum backoff";
                     leaf initial-backoff {
                       type uint32;
                       units "seconds";
                       default 30;
                       description
                         "Initial backoff time";
                     }



Cardona , et al.        Expires September 3, 2023              [Page 19]

Internet-Draft               BMP YANG Module                  March 2023


                     leaf maximum-backoff {
                       type uint32;
                       units "seconds";
                       default 720;
                       description
                         "Maximum backoff time";
                     }
                   }
                 }
               }
             }
           }

           container bmp-data {
             description
               "Configuration of BMP data";

             leaf initiation-message {
               type string;
               description
                 "User defined message to append to the
                  initiation message";
               reference "RFC7854:  BGP Monitoring Protocol,
                 Section 4.3 and 4.4";
             }

             container bmp-statistics-report  {
               presence "Enables the BMP statistics report";

               description "Configuration of the statistics report";
               reference "RFC7854:  BGP Monitoring Protocol,
                 Section 4.8";


               leaf statistics-interval {
                 type uint32;
                 units "seconds";
                 mandatory true;
                 description
                   "Interval for statistic report message.";
               }

             }

             container bmp-route-monitoring {
               description
                 "Configuration of the data sources for
                 route-monitoring messages";



Cardona , et al.        Expires September 3, 2023              [Page 20]

Internet-Draft               BMP YANG Module                  March 2023


               uses bmp-route-monitoring-sources;
             }
           }

           container session-stats {
             description
               "stats and operational values for the station";

             leaf discontinuity-time {
                type yang:date-and-time;
                mandatory true;
                description
                  "The time on the most recent occasion at which any
                  one or more of this station's counters suffered a
                  discontinuity.  If no such discontinuities have
                  occurred since the last re-initialization of the
                  local management subsystem, then this node contains
                  the time the local management subsystem
                  re-initialized itself.";
              }

             leaf established-session {
               type boolean;
               config false;
               description
                 "Value indicating if the session is currently
                  established";
             }
             leaf total-route-monitoring-messages {
               type uint64;
               config false;
               description
                 "Number of route-monitoring messages sent since last
                  successful connection";
             }
             leaf total-statistics-messages {
               type uint64;
               config false;
               description
                 "Number of statistics messages sent since last
                  successful connection";
             }
             leaf total-peer-down-messages {
               type uint64;
               config false;
               description
                 "Number of peer-down messages sent since last
                  successful connection";



Cardona , et al.        Expires September 3, 2023              [Page 21]

Internet-Draft               BMP YANG Module                  March 2023


             }
             leaf total-peer-up-messages {
               type uint64;
               config false;
               description
                 "Number of peer-up messages sent since last successful
                  connection";
             }
             leaf total-initiation-messages {
               type uint64;
               config false;
               description
                 "Number of initiation messages sent since last
                  successful connection";
             }
             leaf total-route-mirroring-messages {
               type uint64;
               config false;
               description
                 "Number of route-mirroring messages sent since last
                  successful connection";
             }
           }


           container actions {
             nacm:default-deny-all;
             description
               "Container with the actions for the BMP operation";
             action session-reset {
               description
                 "Resets the session for a station.";
               output {
                 choice outcome {
                   description
                     "Output of the reset operation. Either a success or
                      failure. For the latter, the reason for the
                      error is provided.";
                   leaf success {
                     type empty;
                     description
                       "Reset successful";
                   }
                   leaf failure {
                     type string;
                     description
                       "Reset could not be performed.
                       Reason is included in the field";



Cardona , et al.        Expires September 3, 2023              [Page 22]

Internet-Draft               BMP YANG Module                  March 2023


                   }
                 }
               }
             }
           }

         }



       }


     }
   }

   <CODE ENDS>

5.  Security Considerations

   The YANG module specified in this document defines a schema for data
   that is designed to be accessed via network management protocols such
   as NETCONF [RFC6241] or RESTCONF [RFC8040].  The lowest NETCONF layer
   is the secure transport layer, and the mandatory-to-implement secure
   transport is Secure Shell (SSH) [RFC6242].  The lowest RESTCONF layer
   is HTTPS, and the mandatory-to-implement secure transport is TLS
   [RFC8446].  The NETCONF Access Control Model (NACM) [RFC8341]
   provides the means to restrict access for NETCONF or RESTCONF users
   to a preconfigured subset of all available NETCONF or RESTCONF
   protocol operations and content.

   BGP data is sensible for security considerations.  The model
   described in this document could be used to send BGP information to
   malicious BMP stations.  Write access to this model SHOULD therefore
   be properly protected.

   The session-reset action can demand considerable amount of resources
   from network elements.  It SHOULD thus be protected from illegal
   access.

6.  IANA Considerations

6.1.  The IETF XML Registry

   This document registers a URIs in the IETF XML registry [RFC3688].
   Following the format in [RFC3688], the following registrations are
   requested:




Cardona , et al.        Expires September 3, 2023              [Page 23]

Internet-Draft               BMP YANG Module                  March 2023


      URI: urn:ietf:params:xml:ns:yang:ietf-bmp
      Registrant Contact: The IESG.
      XML: N/A, the requested URI is an XML namespace.

6.2.  The YANG Module Name Registration

   This document registers the following YANG module in the " YANG
   Module Names" registry registry [RFC6020]:

      Name: ietf-bmp
      Namespace: urn:ietf:params:xml:ns:yang:ietf-bmp
      Prefix: bmp
      Reference: [This RFC-to-be]

7.  Open Issues

      The security considerations section will have to be aligned with
      https://trac.ietf.org/trac/ops/wiki/yang-security-guidelines

8.  Normative References

   [I-D.ietf-idr-bgp-model]
              Jethanandani, M., Patel, K., Hares, S., and J. Haas, "BGP
              YANG Model for Service Provider Networks", draft-ietf-idr-
              bgp-model-15 (work in progress), October 2022,
              <https://www.ietf.org/archive/id/draft-ietf-idr-bgp-model-
              15.txt>.

   [I-D.ietf-netconf-tcp-client-server]
              Watsen, K. and M. Scharf, "YANG Groupings for TCP Clients
              and TCP Servers", draft-ietf-netconf-tcp-client-server-15
              (work in progress), December 2022,
              <https://www.ietf.org/archive/id/draft-ietf-netconf-tcp-
              client-server-15.txt>.

   [RFC1191]  Mogul, J. and S. Deering, "Path MTU discovery", RFC 1191,
              DOI 10.17487/RFC1191, November 1990,
              <https://www.rfc-editor.org/info/rfc1191>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC3688]  Mealling, M., "The IETF XML Registry", BCP 81, RFC 3688,
              DOI 10.17487/RFC3688, January 2004,
              <https://www.rfc-editor.org/info/rfc3688>.




Cardona , et al.        Expires September 3, 2023              [Page 24]

Internet-Draft               BMP YANG Module                  March 2023


   [RFC6020]  Bjorklund, M., Ed., "YANG - A Data Modeling Language for
              the Network Configuration Protocol (NETCONF)", RFC 6020,
              DOI 10.17487/RFC6020, October 2010,
              <https://www.rfc-editor.org/info/rfc6020>.

   [RFC6241]  Enns, R., Ed., Bjorklund, M., Ed., Schoenwaelder, J., Ed.,
              and A. Bierman, Ed., "Network Configuration Protocol
              (NETCONF)", RFC 6241, DOI 10.17487/RFC6241, June 2011,
              <https://www.rfc-editor.org/info/rfc6241>.

   [RFC6242]  Wasserman, M., "Using the NETCONF Protocol over Secure
              Shell (SSH)", RFC 6242, DOI 10.17487/RFC6242, June 2011,
              <https://www.rfc-editor.org/info/rfc6242>.

   [RFC6991]  Schoenwaelder, J., Ed., "Common YANG Data Types",
              RFC 6991, DOI 10.17487/RFC6991, July 2013,
              <https://www.rfc-editor.org/info/rfc6991>.

   [RFC7854]  Scudder, J., Ed., Fernando, R., and S. Stuart, "BGP
              Monitoring Protocol (BMP)", RFC 7854,
              DOI 10.17487/RFC7854, June 2016,
              <https://www.rfc-editor.org/info/rfc7854>.

   [RFC8040]  Bierman, A., Bjorklund, M., and K. Watsen, "RESTCONF
              Protocol", RFC 8040, DOI 10.17487/RFC8040, January 2017,
              <https://www.rfc-editor.org/info/rfc8040>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8177]  Lindem, A., Ed., Qu, Y., Yeung, D., Chen, I., and J.
              Zhang, "YANG Data Model for Key Chains", RFC 8177,
              DOI 10.17487/RFC8177, June 2017,
              <https://www.rfc-editor.org/info/rfc8177>.

   [RFC8341]  Bierman, A. and M. Bjorklund, "Network Configuration
              Access Control Model", STD 91, RFC 8341,
              DOI 10.17487/RFC8341, March 2018,
              <https://www.rfc-editor.org/info/rfc8341>.

   [RFC8349]  Lhotka, L., Lindem, A., and Y. Qu, "A YANG Data Model for
              Routing Management (NMDA Version)", RFC 8349,
              DOI 10.17487/RFC8349, March 2018,
              <https://www.rfc-editor.org/info/rfc8349>.






Cardona , et al.        Expires September 3, 2023              [Page 25]

Internet-Draft               BMP YANG Module                  March 2023


   [RFC8446]  Rescorla, E., "The Transport Layer Security (TLS) Protocol
              Version 1.3", RFC 8446, DOI 10.17487/RFC8446, August 2018,
              <https://www.rfc-editor.org/info/rfc8446>.

   [RFC8529]  Berger, L., Hopps, C., Lindem, A., Bogdanovic, D., and X.
              Liu, "YANG Data Model for Network Instances", RFC 8529,
              DOI 10.17487/RFC8529, March 2019,
              <https://www.rfc-editor.org/info/rfc8529>.

   [RFC8671]  Evens, T., Bayraktar, S., Lucente, P., Mi, P., and S.
              Zhuang, "Support for Adj-RIB-Out in the BGP Monitoring
              Protocol (BMP)", RFC 8671, DOI 10.17487/RFC8671, November
              2019, <https://www.rfc-editor.org/info/rfc8671>.

   [RFC9069]  Evens, T., Bayraktar, S., Bhardwaj, M., and P. Lucente,
              "Support for Local RIB in the BGP Monitoring Protocol
              (BMP)", RFC 9069, DOI 10.17487/RFC9069, February 2022,
              <https://www.rfc-editor.org/info/rfc9069>.

Appendix A.  Examples

   This sections shows some examples of BMP configuration using the
   model.

A.1.  Example one

   In this example, the device connects to a monitoring station using an
   active connection.  The devices sends route monitoring messages for
   the global instance, the adj-rib-out-pre RIB, the IPv4/IPv6 address
   family, and external peers.

   =============== NOTE: '\' line wrapping per RFC 8792 ================

   <bmp xmlns="urn:ietf:params:xml:ns:yang:ietf-bmp">
   <monitoring-stations>
     <monitoring-station>
       <id>1</id>
       <connection>
         <active>
           <station-address>192.0.2.1</station-address>
           <station-port>57992</station-port>
           <local-address>192.0.2.2</local-address>
         </active>
       </connection>
       <bmp-data>
         <bmp-route-monitoring>
           <network-instances>
             <network-instance>



Cardona , et al.        Expires September 3, 2023              [Page 26]

Internet-Draft               BMP YANG Module                  March 2023


                 <network-instance-id>
                         bmp-ni-types-global-ni</network-instance-id>
               <adj-rib-in-pre>
                 <address-families>
                   <address-family>
                       <address-family-id
                   xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-types\
   ">
                               bt:ipv6-unicast</address-family-id>
                     <peers>
                       <peer>
                         <peer-id>external</peer-id>
                       </peer>
                     </peers>
                   </address-family>
                   <address-family>
                       <address-family-id
                  xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-types">
                               bt:ipv4-unicast</address-family-id>
                     <peers>
                       <peer>
                         <peer-id>external</peer-id>
                       </peer>
                     </peers>
                   </address-family>
                 </address-families>
               </adj-rib-in-pre>
             </network-instance>
           </network-instances>
         </bmp-route-monitoring>
       </bmp-data>
     </monitoring-station>
   </monitoring-stations>
   </bmp>

A.2.  Example two

   In the next example, the device connects to a monitoring station
   using a passive connection, over the network-instance monitoring.
   The configuration of route monitoring messages is more complex than
   in the previous example.  It shows how to combine the configuration
   of general identities of network instances and peers (e.g.  bmp-ni-
   types-all-ni for NI, external for peers), and individual
   configurations to support a more complex requirement.  This is what
   the example expects to configure:






Cardona , et al.        Expires September 3, 2023              [Page 27]

Internet-Draft               BMP YANG Module                  March 2023


   o  For the global network instance, the device sends updates for adj-
      rib-in-pre, address families IPv4 and IPv6.  It sends updates for
      all external peers except peer 128.66.1.1, which is disabled.

   o  Network instance monitoring is disabled for route monitoring
      messages.

   o  For the rest of network instances, we are enabling messages from
      adj-rib-in-pre, address families IPv4/IPv6, and for all peers.

   =============== NOTE: '\' line wrapping per RFC 8792 ================

   <bmp xmlns="urn:ietf:params:xml:ns:yang:ietf-bmp">
       <monitoring-stations>
         <monitoring-station>
           <id>2</id>
           <connection>
             <passive>
               <network-instance>monitoring</network-instance>
               <station-address>192.0.2.1</station-address>
               <local-address>192.0.2.2</local-address>
               <local-port>57993</local-port>
             </passive>
           </connection>
           <bmp-data>
             <bmp-route-monitoring>
               <network-instances>
                 <network-instance>
                     <network-instance-id>
                             bmp-ni-types-all-ni</network-instance-id>
                   <adj-rib-in-pre>
                     <address-families>
                       <address-family>
                           <address-family-id
                     xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-typ\
   es">
                                   bt:ipv6-unicast</address-family-id>
                         <peers>
                           <peer>
                             <peer-id>bmp-peer-types-all-peers</peer-id>
                           </peer>
                         </peers>
                       </address-family>
                       <address-family>
                           <address-family-id
                     xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-typ\
   es">
                                   bt:ipv4-unicast</address-family-id>



Cardona , et al.        Expires September 3, 2023              [Page 28]

Internet-Draft               BMP YANG Module                  March 2023


                         <peers>
                           <peer>
                             <peer-id>bmp-peer-types-all-peers</peer-id>
                           </peer>
                         </peers>
                       </address-family>
                     </address-families>
                   </adj-rib-in-pre>
                 </network-instance>
                 <network-instance>
                     <network-instance-id>
                             bmp-ni-types-global-ni</network-instance-i\
   d>
                   <adj-rib-in-pre>
                     <address-families>
                       <address-family>
                           <address-family-id
                    xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-type\
   s">
                                   bt:ipv6-unicast</address-family-id>
                         <peers>
                           <peer>
                             <peer-id>128.66.1.1</peer-id>
                             <enabled>false</enabled>
                           </peer>
                           <peer>
                             <peer-id>external</peer-id>
                           </peer>
                         </peers>
                       </address-family>
                       <address-family>
                           <address-family-id
                   xmlns:bt="urn:ietf:params:xml:ns:yang:ietf-bgp-types\
   ">
                                   bt:ipv4-unicast</address-family-id>
                         <peers>
                           <peer>
                             <peer-id>128.66.1.1</peer-id>
                             <enabled>false</enabled>
                           </peer>
                           <peer>
                             <peer-id>external</peer-id>
                           </peer>
                         </peers>
                       </address-family>
                     </address-families>
                   </adj-rib-in-pre>
                 </network-instance>



Cardona , et al.        Expires September 3, 2023              [Page 29]

Internet-Draft               BMP YANG Module                  March 2023


                 <network-instance>
                   <network-instance-id>monitoring</network-instance-id>
                   <enabled>false</enabled>
                 </network-instance>
               </network-instances>
             </bmp-route-monitoring>
           </bmp-data>
         </monitoring-station>
       </monitoring-stations>
     </bmp>

Acknowledgements

   The authors would like to thank Yimin Shen, Jeff Haas, Pierre Vander
   Vorst, and Tom Petch for their review and feedback.

Authors' Addresses

   Camilo Cardona
   NTT
   164-168, Carrer de Numancia
   Barcelona  08029
   Spain

   Email: camilo@ntt.net


   Paolo Lucente
   NTT
   Siriusdreef 70-72
   Hoofddorp, WT  2132
   Netherlands

   Email: paolo@ntt.net


   Thomas Graf
   Swisscom
   Binzring 17
   Zurich 8045
   Switzerland

   Email: thomas.graf@swisscom.com








Cardona , et al.        Expires September 3, 2023              [Page 30]

Internet-Draft               BMP YANG Module                  March 2023


   Benoit Claise
   Huawei

   Email: benoit.claise@huawei.com















































Cardona , et al.        Expires September 3, 2023              [Page 31]
